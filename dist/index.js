(()=>{"use strict";var e={811:function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,i)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&n(t,e,o);return i(t,e),t},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_URL=t.devMode=void 0,o(469);const a=u(o(252)),d=u(o(96)),s=u(o(577)),l=u(o(525)),c=r(o(140)),f=u(o(715)),h=u(o(225)),v=u(o(236)),p=u(o(116)),_=u(o(457)),y=(0,a.default)();y.use((0,l.default)()),t.devMode="development"===y.get("env"),t.BASE_URL=t.devMode?"http://localhost:5000/vootv":"",y.use((0,d.default)("dev")),y.use((0,s.default)()),y.use(a.default.json()),y.use(a.default.urlencoded({extended:!0})),y.get("/",((e,t)=>t.status(200).send('\n  <div style="display: flex; align-items: center; justify-content: center; height: 90vh"> \n    <h1 style="font-size: 72px; background: -webkit-linear-gradient(45deg, #09009f, #00ff95 80%); -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;">VOO TV REST API</h1>\n  </div>\n'))),y.use("/user",f.default),y.use("/audio",h.default),y.use("/location",v.default),y.use("/service",p.default),y.use("/tests",_.default),y.use(((e,t,o)=>o((0,c.default)(404,"Endpoint not found")))),y.use(((e,t,o,n)=>{console.error(e);let i="An unknown error occurred",r=500;(0,c.isHttpError)(e)&&(r=e.status,i=e.message),o.status(r).json(i)})),t.default=y},48:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(548),u=i(o(140)),a=o(432);t.default=(0,r.Controller)({addAudio(e,t){return n(this,void 0,void 0,(function*(){if(!e.file)throw(0,u.default)(403,"No file received");const o=e.file.buffer,n=e.file.originalname,i=e.file.mimetype,r=yield(0,a.authorize)(),d=yield(0,a.uploadFile)(r,o,n,i);console.log(d),console.log(d.data),t.status(201).send("Okay")}))}})},255:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(548),u=i(o(140)),a=i(o(297));t.default=(0,r.Controller)({addLocation(e,t){return n(this,void 0,void 0,(function*(){const{country:o,state:n,pastorInCharge:i}=e.body;if(yield a.default.location.findUnique({where:{country_state_pastorInCharge:{country:o,state:n,pastorInCharge:i}}}))throw(0,u.default)(403,"Location exists");return yield a.default.location.create({data:e.body}),t.status(201).send("New location added")}))},getLocations(e,t){return n(this,void 0,void 0,(function*(){const e=yield a.default.location.findMany();t.status(200).json(e)}))},getLocation(){return n(this,void 0,void 0,(function*(){}))},updateLocation(e,t){return n(this,void 0,void 0,(function*(){const{id:o}=e.params,n=yield a.default.location.findUnique({where:{id:o}});if(!n)throw(0,u.default)(403,"Location not found");return yield a.default.location.update({where:{id:n.id},data:e.body}),t.status(200).send("Location details updated")}))}})},197:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(548),u=i(o(140)),a=i(o(297));t.default=(0,r.Controller)({addService(e,t){return n(this,void 0,void 0,(function*(){const{theme:o,day:n}=e.body;if(yield a.default.service.findUnique({where:{theme_day:{theme:o,day:n}}}))throw(0,u.default)(403,"Service exists, update to continue");return yield a.default.service.create({data:e.body}),t.status(201).send("Service added")}))}})},435:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(548),u=o(486),a=i(o(140)),d=i(o(982)),s=o(977),l=i(o(297));t.default=(0,r.Controller)({register(e,t){return n(this,void 0,void 0,(function*(){const{email:o,password:n,phoneNumber:i}=e.body;if(yield l.default.user.findFirst({where:{OR:[{email:o},{phoneNumber:i}]}}))throw(0,a.default)(403,"Account already exists, please login");const r=yield(0,u.hash)(n,10),c=yield l.default.user.create({data:Object.assign(Object.assign({},e.body),{password:r,role:"USER"})}),{email:f,id:h}=c,v=d.default.randomInt(1e3,9999).toString(),p=yield l.default.verficationCode.create({data:{userId:h,code:v,action:"EMAIL_VERIFICATION"}});yield s.default_transporter.sendMail({from:"RCN Global Network",to:c.email,subject:"Email verification code",html:`<p>This is your verification code. It will expire in 15 minutes.</p><strong>${p.code}</strong>`,replyTo:"noreply@rcn.com"});return t.status(200).json({message:"Verification code sent to email address",userId:h})}))},verifyEmail(e,t){return n(this,void 0,void 0,(function*(){const{code:o,userId:n}=e.body,i=yield l.default.user.findUnique({where:{id:n}});if(!i)throw(0,a.default)(404,"User not found");const r=yield l.default.verficationCode.findUnique({where:{userId_action:{userId:n,action:"EMAIL_VERIFICATION"}}});if(!r)throw(0,a.default)(403,"Code expired, request new code");if(r.code!==o)throw(0,a.default)(403,"Invalid code, retry");return yield l.default.user.update({where:{id:i.id},data:{emailVerified:!0}}),yield l.default.verficationCode.delete({where:{id:r.id}}),t.status(200).send("Email verification successful")}))},resendVerificationCode(e,t){return n(this,void 0,void 0,(function*(){return t.status(200).json("Okay")}))},login(e,t){return n(this,void 0,void 0,(function*(){const{email:o,password:n}=e.body,i=yield l.default.user.findUnique({where:{email:o}});if(!i)throw(0,a.default)(403,"Invalid email or password");if(!(yield(0,u.compare)(n,i.password)))throw(0,a.default)(403,"Invalid email or password");return t.status(200).json("Log in success")}))},sendPasswordResetMail(e,t){return n(this,void 0,void 0,(function*(){const{email:o}=e.body,n=yield l.default.user.findUnique({where:{email:o}});if(!n)throw(0,a.default)(403,"User not found");const i=d.default.randomInt(1e3,9999).toString(),r=yield l.default.verficationCode.create({data:{userId:n.id,code:i,action:"PASSWORD_RESET"}});if(!r)throw(0,a.default)(403,"Could not create verification code");yield s.default_transporter.sendMail({from:"RCN Global Network",to:n.email,subject:"Password reset code",html:`<p>This is your password reset code. It expires in 15 minutes.</p><strong>${r.code}</strong>`,replyTo:"noreply@rcn.com"});return t.status(200).json("Check your email for your password reset code")}))},verifyPasswordResetCode(e,t){return n(this,void 0,void 0,(function*(){const{code:o,userId:n}=e.body,i=yield l.default.verficationCode.findFirst({where:{code:o,userId:n,action:"PASSWORD_RESET"}});if(!i)throw(0,a.default)(403,"Code expired, request new code");if(o!==i.code)throw(0,a.default)(403,"Invalid code, try again");return t.status(200).json("Verified")}))},changePassword(e,t){return n(this,void 0,void 0,(function*(){const{password:o,userId:n}=e.body;if(!(yield l.default.user.findUnique({where:{id:n}})))throw(0,a.default)(403,"User not found");const i=yield(0,u.hash)(o,10);return yield l.default.user.update({where:{id:n},data:{password:i}}),t.status(200).json("Password changed")}))}})},156:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(811)),r=n(o(418)).default.PORT;i.default.listen(r,(()=>console.log("Listening on PORT "+r)))},225:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(252),r=n(o(48)),u=n(o(461)),a=(0,u.default)({storage:u.default.memoryStorage()}),d=(0,i.Router)();d.post("/add",a.single("audio"),r.default.addAudio),t.default=d},236:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(252),r=n(o(255)),u=(0,i.Router)();u.get("/get-locations",r.default.getLocations),u.get("/get-location/:id",r.default.getLocation),u.post("/add-location",r.default.addLocation),u.patch("/update-location/:id",r.default.updateLocation),t.default=u},116:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(252),r=n(o(197)),u=(0,i.Router)();u.post("/add-service",r.default.addService),t.default=u},715:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(252),r=n(o(435)),u=(0,i.Router)();u.post("/register",r.default.register),u.post("/verify-email",r.default.verifyEmail),u.get("/resend-email-verify-code",r.default.resendVerificationCode),t.default=u},457:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(252),u=i(o(170)),a=o(843),d=(0,r.Router)();d.post("/redis",((e,t)=>n(void 0,void 0,void 0,(function*(){yield u.default.set("buyStatus","disabled");const e=yield u.default.get("buyStatus");console.log(e),t.status(200).json("okay")})))),d.post("/queue",((e,t)=>n(void 0,void 0,void 0,(function*(){yield a.myQueue.add("test",{foo:"bar"},{delay:5e3}),yield a.myQueue.add("test",{foo:"bar"},{delay:5e3}),t.status(200).json("Job added")})))),t.default=d},297:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=o(330);let i;global.__prisma||(global.__prisma=new n.PrismaClient),i=global.__prisma,t.default=i},418:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=o(991);t.default=(0,n.cleanEnv)(process.env,{PORT:(0,n.port)(),JWT_SECRET:(0,n.str)(),ADMIN_EMAIL:(0,n.email)(),ADMIN_PASSWORD:(0,n.str)(),GOOGLE_DRIVE_CLIENT_EMAIL:(0,n.str)(),GOOGLE_DRIVE_SECRET_KEY:(0,n.str)()})},432:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.uploadFile=t.authorize=void 0;const r=o(850),u=o(203),a=i(o(418)),d=["https://www.googleapis.com/auth/drive.file"];t.authorize=function(){return n(this,void 0,void 0,(function*(){const e=new r.google.auth.JWT(a.default.GOOGLE_DRIVE_CLIENT_EMAIL,null,a.default.GOOGLE_DRIVE_SECRET_KEY.replace(/\\n/g,"\n"),d);return yield e.authorize(),e}))},t.uploadFile=function(e,t,o,i){return n(this,void 0,void 0,(function*(){const n=r.google.drive({version:"v3",auth:e}),a=u.Readable.from(t);return yield n.files.create({requestBody:{name:o,parents:["1fi7fW0b3gW7-vS30KfgTLqW87l23cFnZ"]},media:{mimeType:i,body:a},fields:"id"})}))}},170:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=new(n(o(659)).default)({maxRetriesPerRequest:null});t.default=i},977:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default_transporter=void 0;const i=n(o(572)),r=n(o(928)),u=n(o(628)),a=n(o(418)),d=i.default.createTransport({service:"gmail",port:465,secure:!0,auth:{user:a.default.ADMIN_EMAIL,pass:a.default.ADMIN_PASSWORD}});t.default_transporter=d;const s={viewEngine:{extname:".handlebars",partialsDir:r.default.resolve(__dirname,"../views/partials"),defaultLayout:!1},viewPath:r.default.resolve(__dirname,"../views"),extName:".handlebars"};d.use("compile",(0,u.default)(s)),t.default=d},548:function(e,t){var o=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;const n=e=>(t,n,i)=>o(void 0,void 0,void 0,(function*(){try{yield e(t,n,i)}catch(e){i(e)}}));t.Controller=e=>{for(let t of Object.keys(e))e[t]=n(e[t]);return e}},843:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function u(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(u,a)}d((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.worker=t.myQueue=void 0;const r=o(367),u=i(o(170)),a=new r.Queue("firstQueue",{connection:u.default});t.myQueue=a;const d=new r.Worker("firstQueue",(e=>n(void 0,void 0,void 0,(function*(){return console.log("Processing job:",e.data),yield new Promise((e=>setTimeout(e,1e3))),console.log("Job processed"),{success:!0}}))),{connection:u.default});t.worker=d},330:e=>{e.exports=require("@prisma/client")},486:e=>{e.exports=require("bcrypt")},367:e=>{e.exports=require("bullmq")},577:e=>{e.exports=require("cors")},469:e=>{e.exports=require("dotenv/config")},991:e=>{e.exports=require("envalid")},252:e=>{e.exports=require("express")},850:e=>{e.exports=require("googleapis")},525:e=>{e.exports=require("helmet")},140:e=>{e.exports=require("http-errors")},659:e=>{e.exports=require("ioredis")},96:e=>{e.exports=require("morgan")},461:e=>{e.exports=require("multer")},572:e=>{e.exports=require("nodemailer")},628:e=>{e.exports=require("nodemailer-express-handlebars")},982:e=>{e.exports=require("crypto")},928:e=>{e.exports=require("path")},203:e=>{e.exports=require("stream")}},t={};(function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports})(156)})();
//# sourceMappingURL=index.js.map